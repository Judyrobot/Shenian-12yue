# 水下照明模拟器技术文档

## 1. 程序概述

水下照明模拟器是一款用于模拟水下环境中多光源照明效果的工具，可帮助优化水下光源布置方案，评估照明覆盖范围和强度分布。程序采用数值模拟方法，考虑了光在水中的吸收、散射、湍流等多种物理效应，提供直观的3D可视化结果和关键性能指标。

## 2. 参数说明与调整指南

### 2.1 光源参数 (Light Source Params)

| 参数名称 | 单位 | 含义 | 调整方法 | 范围建议 |
|---------|------|------|---------|---------|
| X Position | 米(m) | 光源在X轴上的位置坐标 | 在输入框中直接修改数值 | -8至8 |
| Y Position | 米(m) | 光源在Y轴上的位置坐标 | 在输入框中直接修改数值 | -8至8 |
| Z Position | 米(m) | 光源在Z轴上的位置坐标 | 在输入框中直接修改数值 | -2至40 |
| Base Intensity | - | 光源的基础发光强度 | 在输入框中直接修改数值 | 0至100 |
| Scatter Angle | 度(°) | 光源的散射角度 | 在输入框中直接修改数值 | 0至90 |
| Offset Angle | 度(°) | 光源的偏移角度 | 在输入框中直接修改数值 | 0至360 |
| Wavelength | - | 光源的波长类型 | 从下拉菜单选择预设波长 | - |

**操作按钮**：
- Save Params: 保存当前选中光源的参数设置
- Add Light: 添加新的光源
- Delete Light: 删除当前选中的光源

### 2.2 水体属性参数 (Water Properties)

| 参数名称 | 单位 | 含义 | 调整方法 | 范围建议 |
|---------|------|------|---------|---------|
| Water Depth | 米(m) | 模拟水域的深度 | 在输入框中直接修改数值 | 0至100 |
| Base Particle Conc. | kg/m³ | 水中悬浮颗粒的基础浓度 | 在输入框中直接修改数值 | 0至0.5 |
| Depth Particle Factor | - | 颗粒浓度随深度的变化因子 | 在输入框中直接修改数值 | 0至0.1 |

**计算公式**：
颗粒浓度随深度变化公式：`c = 基础浓度 + 深度因子 × 水深`

**操作按钮**：
- Save Water Params: 保存水体属性参数设置

### 2.3 光束属性参数 (Beam Properties)

| 参数名称 | 单位 | 含义 | 调整方法 | 范围建议 |
|---------|------|------|---------|---------|
| Max Beam Angle | 度(°) | 光束的最大扩散角度 | 在输入框中直接修改数值 | 0至90 |
| Angle Attenuation Factor | - | 角度衰减系数 | 在输入框中直接修改数值 | 0至1 |
| Beam Divergence Factor | - | 光束发散因子 | 在输入框中直接修改数值 | 0至0.1 |
| Absorption Enhance Factor | - | 吸收增强因子 | 在输入框中直接修改数值 | 0至1 |
| Scattering Enhance Factor | - | 散射增强因子 | 在输入框中直接修改数值 | 0至2 |

**计算公式**：
光束发散角度：`α_scattered = α + 发散因子 × c × d`
其中：α为光源散射角度，c为颗粒浓度，d为距离

**操作按钮**：
- Save Beam Params: 保存光束属性参数设置

### 2.4 环境影响参数 (Environmental Effects)

| 参数名称 | 单位 | 含义 | 调整方法 | 范围建议 |
|---------|------|------|---------|---------|
| Turbulence Strength | - | 水体湍流强度 | 在输入框中直接修改数值 | 0至0.1 |
| Turbulence Correlation | - | 湍流空间相关性 | 在输入框中直接修改数值 | 0至5 |
| Scattering Asymmetry (g) | - | 散射各向异性因子 | 在输入框中直接修改数值 | -1至1 |
| Background Noise Factor | - | 背景噪声因子 | 在输入框中直接修改数值 | 0至0.1 |
| Detection Threshold | - | 光强检测阈值 | 在输入框中直接修改数值 | 0至0.1 |

**计算公式**：
亨利-格林斯坦散射相位函数：`p(θ) = (1 - g²) / (1 + g² - 2g cosθ)^1.5`
其中：g为散射各向异性因子，θ为散射角

**操作按钮**：
- Save Env Params: 保存环境影响参数设置

### 2.5 模拟参数 (Simulation Params)

| 参数名称 | 单位 | 含义 | 调整方法 | 范围建议 |
|---------|------|------|---------|---------|
| Ref Distance (d0) | 米(m) | 参考距离 | 在输入框中直接修改数值 | 0.1至5 |
| Distance Decay Coeff (n) | - | 距离衰减系数 | 在输入框中直接修改数值 | 1至3 |
| X Samples | - | X轴方向采样点数 | 在输入框中直接修改数值 | 10至200 |
| Y Samples | - | Y轴方向采样点数 | 在输入框中直接修改数值 | 10至200 |
| Z Samples | - | Z轴方向采样点数 | 在输入框中直接修改数值 | 10至200 |
| Beam Range Threshold | 米(m) | 光束范围判断阈值 | 在输入框中直接修改数值 | 1至10 |
| Light Saturation Distance | 米(m) | 光源附近强度饱和距离 | 在输入框中直接修改数值 | 0.01至1 |

**计算公式**：
距离衰减因子：`1 / (1 + (α_scattered × d / d0)^n)`
其中：d0为参考距离，n为衰减系数，d为距离

**操作按钮**：
- Save Sim Params: 保存模拟参数设置

### 2.6 覆盖范围参数 (Coverage Params)

| 参数名称 | 单位 | 含义 | 调整方法 | 范围建议 |
|---------|------|------|---------|---------|
| Minimum Required Lights | 个 | 有效覆盖所需的最少光源数 | 选择单选按钮 | 1至光源总数 |

**说明**：设置一个点需要被多少个光源同时覆盖才被视为有效照明区域，用于评估照明的可靠性和冗余度。

**操作按钮**：
- Save Coverage Params: 保存覆盖范围参数设置

### 2.7 自定义波长参数 (Custom Wavelengths)

| 参数名称 | 单位 | 含义 | 调整方法 | 范围建议 |
|---------|------|------|---------|---------|
| Wavelength Name | - | 波长名称（可包含颜色） | 在输入框中修改名称 | - |
| Absorption Coeff | - | 吸收系数 | 在输入框中直接修改数值 | 0至1 |
| Scattering Coeff | - | 散射系数 | 在输入框中直接修改数值 | 0至1 |

**说明**：不同波长的光在水中的传播特性不同，一般来说，蓝光(450nm)在水中传播最远，红光(650nm)衰减最快。

**操作按钮**：
- Save Wavelength: 保存当前波长参数
- Add Wavelength: 添加新的波长类型
- Delete Wavelength: 删除当前选中的波长类型

## 3. 光强计算原理

程序中光强计算基于以下公式：

```
I = I0 × I_absorb × I_scatter × angle_factor × distance_factor - background_noise
```

其中：
- `I0`：光源初始强度，`I0 = 基础强度 / 立体角`
- `I_absorb`：吸收衰减，`I_absorb = exp(-γ_absorb × (1 + 吸收增强因子 × c) × d)`
- `I_scatter`：散射衰减，`I_scatter = exp(-γ_scatter × (1 + 散射增强因子 × c) × d) × (1 + g)/2`
- `angle_factor`：角度因子，`angle_factor = exp(-0.5 × (θ / σ)^2)`
- `distance_factor`：距离因子，`distance_factor = 1 / (1 + (α_scattered × d / d0)^n)`
- `background_noise`：背景噪声，`background_noise = 背景噪声因子 × c`

## 4. 使用流程

1. **启动程序**：运行脚本或生成的EXE文件，程序将打开主界面
2. **设置参数**：
   - 展开相应的参数面板
   - 调整所需参数
   - 点击各面板的"Save"按钮保存参数
3. **运行模拟**：点击左侧面板底部的"Run Simulation"按钮
4. **查看结果**：
   - 上方文本区域显示关键指标
   - 下方图表区域显示四个视图：3D视图、最大XY截面、XOZ投影、YOZ投影
5. **保存结果**：
   - 点击"Save Image"保存当前图表
   - 点击"Save Data"保存模拟数据和结果摘要

## 5. 结果解释

### 5.1 关键指标

- **Nearest to light source**：离光源最近的有效点及其强度和覆盖光源数
- **Farthest from light source**：离光源最远的有效点及其强度和覆盖光源数
- **Valid Volume**：有效照明空间的体积
- **Max XOY Section**：最大XY截面面积及其所在深度
- **XOZ Projection Area**：XOZ平面投影面积
- **YOZ Projection Area**：YOZ平面投影面积
- **Detection Threshold**：光强检测阈值

### 5.2 图表解释

1. **3D视图**：展示三维空间中的有效照明区域，颜色表示光强大小
   - 绿色点：离光源最远的有效点
   - 红色点：离光源最近的有效点
   - 橙色点：光源位置

2. **最大XY截面**：展示在某一深度上的最大照明截面，颜色表示光强大小

3. **XOZ投影**：展示照明区域在XOZ平面上的投影，颜色表示光强大小

4. **YOZ投影**：展示照明区域在YOZ平面上的投影，颜色表示光强大小

## 6. 注意事项

1. 采样点数越多，模拟结果越精确，但计算时间也越长
2. 光源数量增加会提高计算复杂度，建议根据实际需求设置
3. 不同波长的光在水中传播特性差异较大，选择合适的波长对模拟结果至关重要
4. 水体中颗粒浓度对光的传播影响显著，应根据实际水质情况设置
5. 模拟结果为理论计算值，实际水下环境可能受更多因素影响

## 7. 故障排除

1. **模拟无结果**：
   - 检查检测阈值是否设置过高
   - 检查所需最少光源数是否超过实际光源总数
   - 检查光源强度是否足够

2. **计算缓慢**：
   - 减少采样点数量
   - 减少光源数量
   - 减小光束范围判断阈值

3. **程序崩溃**：
   - 检查参数是否在合理范围内
   - 尝试减少采样点数量
   - 确保所有依赖库已正确安装